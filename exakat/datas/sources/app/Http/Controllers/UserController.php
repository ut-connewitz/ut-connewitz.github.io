<span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><a name="l1" /><br /><a name="l2" /></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">App</span><span style="color: #007700">\</span><span style="color: #0000BB">Http</span><span style="color: #007700">\</span><span style="color: #0000BB">Controllers</span><span style="color: #007700">;<br /><a name="l3" /><br /><a name="l4" />use&nbsp;</span><span style="color: #0000BB">Illuminate</span><span style="color: #007700">\</span><span style="color: #0000BB">Http</span><span style="color: #007700">\</span><span style="color: #0000BB">Request</span><span style="color: #007700">;<br /><a name="l5" />use&nbsp;</span><span style="color: #0000BB">App</span><span style="color: #007700">\</span><span style="color: #0000BB">Http</span><span style="color: #007700">\</span><span style="color: #0000BB">Controllers</span><span style="color: #007700">\</span><span style="color: #0000BB">Controller</span><span style="color: #007700">;<br /><a name="l6" />use&nbsp;</span><span style="color: #0000BB">App</span><span style="color: #007700">\</span><span style="color: #0000BB">User</span><span style="color: #007700">;<br /><a name="l7" />use&nbsp;</span><span style="color: #0000BB">Illuminate</span><span style="color: #007700">\</span><span style="color: #0000BB">Support</span><span style="color: #007700">\</span><span style="color: #0000BB">Facades</span><span style="color: #007700">\</span><span style="color: #0000BB">Auth</span><span style="color: #007700">;<br /><a name="l8" />use&nbsp;</span><span style="color: #0000BB">Validator</span><span style="color: #007700">;<br /><a name="l9" />use&nbsp;</span><span style="color: #0000BB">Illuminate</span><span style="color: #007700">\</span><span style="color: #0000BB">Auth</span><span style="color: #007700">\</span><span style="color: #0000BB">AuthenticationException</span><span style="color: #007700">;<br /><a name="l10" /><br /><a name="l11" />class&nbsp;</span><span style="color: #0000BB">UserController&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">Controller<br /><a name="l12" /></span><span style="color: #007700">{<br /><a name="l13" />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$successStatus&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">;<br /><a name="l14" /><br /><a name="l15" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br /><a name="l16" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;login&nbsp;api<br /><a name="l17" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /><a name="l18" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;\Illuminate\Http\Response<br /><a name="l19" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br /><a name="l20" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">login</span><span style="color: #007700">(){<br /><a name="l21" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">Auth</span><span style="color: #007700">::</span><span style="color: #0000BB">attempt</span><span style="color: #007700">([</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">request</span><span style="color: #007700">(</span><span style="color: #DD0000">'name'</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">'password'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">request</span><span style="color: #007700">(</span><span style="color: #DD0000">'password'</span><span style="color: #007700">)])){<br /><a name="l22" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Auth</span><span style="color: #007700">::</span><span style="color: #0000BB">user</span><span style="color: #007700">();<br /><a name="l23" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">[</span><span style="color: #DD0000">'token'</span><span style="color: #007700">]&nbsp;=&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createToken</span><span style="color: #007700">(</span><span style="color: #DD0000">'MyApp'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">accessToken</span><span style="color: #007700">;<br /><a name="l24" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">response</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">json</span><span style="color: #007700">(</span><span style="color: #0000BB">$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">successStatus</span><span style="color: #007700">);<br /><a name="l25" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l26" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else{<br /><a name="l27" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;return&nbsp;response()-&gt;json(['error'=&gt;'Unauthorised'],&nbsp;401);<br /><a name="l28" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /><a name="l29" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">AuthenticationException</span><span style="color: #007700">;<br /><a name="l30" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l31" /><br /><a name="l32" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br /><a name="l33" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Register&nbsp;api<br /><a name="l34" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /><a name="l35" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;\Illuminate\Http\Response<br /><a name="l36" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br /><a name="l37" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">register</span><span style="color: #007700">(</span><span style="color: #0000BB">Request&nbsp;$request</span><span style="color: #007700">)<br /><a name="l38" />&nbsp;&nbsp;&nbsp;&nbsp;{<br /><a name="l39" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$validator&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Validator</span><span style="color: #007700">::</span><span style="color: #0000BB">make</span><span style="color: #007700">(</span><span style="color: #0000BB">$request</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">(),&nbsp;[<br /><a name="l40" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'required'</span><span style="color: #007700">,<br /><a name="l41" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'email'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'required|email'</span><span style="color: #007700">,<br /><a name="l42" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'password'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'required'</span><span style="color: #007700">,<br /><a name="l43" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'password_repeat'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'required|same:password'</span><span style="color: #007700">,<br /><a name="l44" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'role'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'string'</span><span style="color: #007700">,<br /><a name="l45" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]);<br /><a name="l46" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$validator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fails</span><span style="color: #007700">())&nbsp;{<br /><a name="l47" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">response</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">json</span><span style="color: #007700">([</span><span style="color: #DD0000">'error'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$validator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">errors</span><span style="color: #007700">()],&nbsp;</span><span style="color: #0000BB">401</span><span style="color: #007700">);<br /><a name="l48" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l49" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$input&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$request</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /><a name="l50" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$input</span><span style="color: #007700">[</span><span style="color: #DD0000">'password'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">bcrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$input</span><span style="color: #007700">[</span><span style="color: #DD0000">'password'</span><span style="color: #007700">]);<br /><a name="l51" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">create</span><span style="color: #007700">(</span><span style="color: #0000BB">$input</span><span style="color: #007700">);<br /><a name="l52" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$success</span><span style="color: #007700">[</span><span style="color: #DD0000">'token'</span><span style="color: #007700">]&nbsp;=&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createToken</span><span style="color: #007700">(</span><span style="color: #DD0000">'MyApp'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">accessToken</span><span style="color: #007700">;<br /><a name="l53" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$success</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;=&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">;<br /><a name="l54" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">response</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">json</span><span style="color: #007700">(</span><span style="color: #0000BB">$success</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">successStatus</span><span style="color: #007700">);<br /><a name="l55" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l56" /><br /><a name="l57" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br /><a name="l58" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;details&nbsp;api<br /><a name="l59" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /><a name="l60" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;\Illuminate\Http\Response<br /><a name="l61" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br /><a name="l62" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">details</span><span style="color: #007700">()<br /><a name="l63" />&nbsp;&nbsp;&nbsp;&nbsp;{<br /><a name="l64" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Auth&nbsp;is&nbsp;null&nbsp;with&nbsp;our&nbsp;individual&nbsp;auth&nbsp;solution<br /><a name="l65" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;$user&nbsp;=&nbsp;Auth::user();<br /><a name="l66" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;return&nbsp;response()-&gt;json($user,&nbsp;$this-&gt;successStatus);<br /><a name="l67" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">auth</span><span style="color: #007700">(</span><span style="color: #DD0000">'api'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">user</span><span style="color: #007700">())&nbsp;{<br /><a name="l68" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">response</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">json</span><span style="color: #007700">(</span><span style="color: #0000BB">auth</span><span style="color: #007700">(</span><span style="color: #DD0000">'api'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">user</span><span style="color: #007700">(),&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">successStatus</span><span style="color: #007700">);<br /><a name="l69" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l70" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">AuthenticationException</span><span style="color: #007700">;<br /><a name="l71" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l72" /><br /><a name="l73" />}<br /><a name="l74" /></span>
</span>