<span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><a name="l1" /><br /><a name="l2" /></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Illuminate</span><span style="color: #007700">\</span><span style="color: #0000BB">Http</span><span style="color: #007700">\</span><span style="color: #0000BB">Request</span><span style="color: #007700">;<br /><a name="l3" /><br /><a name="l4" />use&nbsp;</span><span style="color: #0000BB">Illuminate</span><span style="color: #007700">\</span><span style="color: #0000BB">Auth</span><span style="color: #007700">\</span><span style="color: #0000BB">AuthenticationException</span><span style="color: #007700">;<br /><a name="l5" />use&nbsp;</span><span style="color: #0000BB">App</span><span style="color: #007700">\</span><span style="color: #0000BB">Http</span><span style="color: #007700">\</span><span style="color: #0000BB">Middleware</span><span style="color: #007700">\</span><span style="color: #0000BB">AuthenticateAdmin</span><span style="color: #007700">;<br /><a name="l6" />use&nbsp;</span><span style="color: #0000BB">App</span><span style="color: #007700">\</span><span style="color: #0000BB">Http</span><span style="color: #007700">\</span><span style="color: #0000BB">Middleware</span><span style="color: #007700">\</span><span style="color: #0000BB">AuthenticateAuthor</span><span style="color: #007700">;<br /><a name="l7" />use&nbsp;</span><span style="color: #0000BB">App</span><span style="color: #007700">\</span><span style="color: #0000BB">Http</span><span style="color: #007700">\</span><span style="color: #0000BB">Middleware</span><span style="color: #007700">\</span><span style="color: #0000BB">AuthenticateUser</span><span style="color: #007700">;<br /><a name="l8" />use&nbsp;</span><span style="color: #0000BB">App</span><span style="color: #007700">\</span><span style="color: #0000BB">Http</span><span style="color: #007700">\</span><span style="color: #0000BB">Controllers</span><span style="color: #007700">\</span><span style="color: #0000BB">JobController</span><span style="color: #007700">;<br /><a name="l9" /><br /><a name="l10" /></span><span style="color: #FF8000">/*<br /><a name="l11" />|--------------------------------------------------------------------------<br /><a name="l12" />|&nbsp;API&nbsp;Routes<br /><a name="l13" />|--------------------------------------------------------------------------<br /><a name="l14" />|<br /><a name="l15" />|&nbsp;Here&nbsp;is&nbsp;where&nbsp;you&nbsp;can&nbsp;register&nbsp;API&nbsp;routes&nbsp;for&nbsp;your&nbsp;application.&nbsp;These<br /><a name="l16" />|&nbsp;routes&nbsp;are&nbsp;loaded&nbsp;by&nbsp;the&nbsp;RouteServiceProvider&nbsp;within&nbsp;a&nbsp;group&nbsp;which<br /><a name="l17" />|&nbsp;is&nbsp;assigned&nbsp;the&nbsp;"api"&nbsp;middleware&nbsp;group.&nbsp;Enjoy&nbsp;building&nbsp;your&nbsp;API!<br /><a name="l18" />|<br /><a name="l19" />*/<br /><a name="l20" /><br /><a name="l21" />/*<br /><a name="l22" />|&nbsp;login&nbsp;and&nbsp;get&nbsp;access&nbsp;token&nbsp;*/<br /><a name="l23" /></span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">post</span><span style="color: #007700">(</span><span style="color: #DD0000">'login'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UserController@login'</span><span style="color: #007700">);<br /><a name="l24" /><br /><a name="l25" /></span><span style="color: #FF8000">/*<br /><a name="l26" />|&nbsp;get&nbsp;details&nbsp;of&nbsp;a&nbsp;user&nbsp;by&nbsp;access&nbsp;token&nbsp;*/<br /><a name="l27" /></span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UserController@details'</span><span style="color: #007700">);<br /><a name="l28" /><br /><a name="l29" /></span><span style="color: #FF8000">/*<br /><a name="l30" />|&nbsp;register&nbsp;a&nbsp;new&nbsp;user&nbsp;*/<br /><a name="l31" /></span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">post</span><span style="color: #007700">(</span><span style="color: #DD0000">'user/register'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UserController@register'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">middleware</span><span style="color: #007700">(</span><span style="color: #DD0000">'auth.admin'</span><span style="color: #007700">);<br /><a name="l32" /><br /><a name="l33" /></span><span style="color: #FF8000">/*<br /><a name="l34" />|--------------------------------------------------------------------------<br /><a name="l35" />|&nbsp;Job&nbsp;Routes<br /><a name="l36" />|--------------------------------------------------------------------------<br /><a name="l37" />*/<br /><a name="l38" />//&nbsp;If&nbsp;cron&nbsp;works&nbsp;-&gt;&nbsp;enable&nbsp;cron-middleware&nbsp;for&nbsp;route&nbsp;/jobs&nbsp;to&nbsp;init&nbsp;cronjobs&nbsp;(caldav&nbsp;sync)<br /><a name="l39" />//&nbsp;Route::middleware(['cron'])-&gt;group(function&nbsp;()&nbsp;{<br /><a name="l40" />//&nbsp;});<br /><a name="l41" /><br /><a name="l42" />/*<br /><a name="l43" />|&nbsp;get&nbsp;all&nbsp;jobs&nbsp;(for&nbsp;author/admin)<br /><a name="l44" />|&nbsp;get&nbsp;only&nbsp;public&nbsp;jobs&nbsp;(for&nbsp;authenticated)&nbsp;*/<br /><a name="l45" /></span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'jobs'</span><span style="color: #007700">,&nbsp;function(</span><span style="color: #0000BB">Request&nbsp;$request</span><span style="color: #007700">)&nbsp;{<br /><a name="l46" />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">AuthenticateAuthor</span><span style="color: #007700">::</span><span style="color: #0000BB">checkAuth</span><span style="color: #007700">(</span><span style="color: #0000BB">$request</span><span style="color: #007700">))&nbsp;{<br /><a name="l47" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(new&nbsp;</span><span style="color: #0000BB">JobController</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">getAll</span><span style="color: #007700">(</span><span style="color: #0000BB">$request</span><span style="color: #007700">);<br /><a name="l48" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l49" />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">AuthenticateUser</span><span style="color: #007700">::</span><span style="color: #0000BB">checkAuth</span><span style="color: #007700">(</span><span style="color: #0000BB">$request</span><span style="color: #007700">))&nbsp;{<br /><a name="l50" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(new&nbsp;</span><span style="color: #0000BB">JobController</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">getAllPublic</span><span style="color: #007700">(</span><span style="color: #0000BB">$request</span><span style="color: #007700">);<br /><a name="l51" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l52" />&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">AuthenticationException</span><span style="color: #007700">;<br /><a name="l53" />});<br /><a name="l54" /><br /><a name="l55" /></span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">middleware</span><span style="color: #007700">([</span><span style="color: #DD0000">'auth.author'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">group</span><span style="color: #007700">(function&nbsp;()&nbsp;{<br /><a name="l56" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;If&nbsp;cron&nbsp;works,&nbsp;we&nbsp;do&nbsp;not&nbsp;need&nbsp;the&nbsp;/jobs/caldavsync&nbsp;route<br /><a name="l57" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'jobs/caldavsync'</span><span style="color: #007700">,&nbsp;function(</span><span style="color: #0000BB">Request&nbsp;$request</span><span style="color: #007700">)&nbsp;{<br /><a name="l58" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Artisan</span><span style="color: #007700">::</span><span style="color: #0000BB">call</span><span style="color: #007700">(</span><span style="color: #DD0000">'schedule:run'</span><span style="color: #007700">);<br /><a name="l59" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"OK"</span><span style="color: #007700">;<br /><a name="l60" />&nbsp;&nbsp;&nbsp;&nbsp;});<br /><a name="l61" /><br /><a name="l62" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l63" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Get&nbsp;specific&nbsp;job&nbsp;by&nbsp;id&nbsp;*/<br /><a name="l64" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'jobs/{job}'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'JobController@get'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'job'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'[0-9]+'</span><span style="color: #007700">);<br /><a name="l65" /><br /><a name="l66" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l67" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Create&nbsp;a&nbsp;new&nbsp;job&nbsp;*/<br /><a name="l68" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">post</span><span style="color: #007700">(</span><span style="color: #DD0000">'jobs'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'JobController@create'</span><span style="color: #007700">);<br /><a name="l69" /><br /><a name="l70" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l71" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Update&nbsp;a&nbsp;specific&nbsp;job&nbsp;by&nbsp;id&nbsp;*/<br /><a name="l72" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">put</span><span style="color: #007700">(</span><span style="color: #DD0000">'jobs/{job}'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'JobController@update'</span><span style="color: #007700">);<br /><a name="l73" /><br /><a name="l74" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l75" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Delete&nbsp;a&nbsp;specific&nbsp;job&nbsp;by&nbsp;id&nbsp;*/<br /><a name="l76" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">delete</span><span style="color: #007700">(</span><span style="color: #DD0000">'jobs/{job}'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'JobController@delete'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'job'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'[0-9]+'</span><span style="color: #007700">);<br /><a name="l77" /><br /><a name="l78" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l79" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Get&nbsp;specific&nbsp;job&nbsp;by&nbsp;id&nbsp;*/<br /><a name="l80" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'jobs/{job}/activities'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'JobController@getActivities'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'job'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'[0-9]+'</span><span style="color: #007700">);<br /><a name="l81" />});<br /><a name="l82" /><br /><a name="l83" /></span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">middleware</span><span style="color: #007700">([</span><span style="color: #DD0000">'auth.user'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">group</span><span style="color: #007700">(function&nbsp;()&nbsp;{<br /><a name="l84" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l85" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Add&nbsp;a&nbsp;user&nbsp;as&nbsp;subscriber&nbsp;to&nbsp;a&nbsp;job&nbsp;*/<br /><a name="l86" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">post</span><span style="color: #007700">(</span><span style="color: #DD0000">'jobs/{job}/subscriber'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'JobController@addSubscriber'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'job'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'[0-9]+'</span><span style="color: #007700">);<br /><a name="l87" /><br /><a name="l88" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l89" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;remove&nbsp;a&nbsp;user&nbsp;from&nbsp;subscribers&nbsp;from&nbsp;a&nbsp;job&nbsp;*/<br /><a name="l90" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">delete</span><span style="color: #007700">(</span><span style="color: #DD0000">'jobs/{job}/subscriber'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'JobController@deleteSubscriber'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'job'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'[0-9]+'</span><span style="color: #007700">);<br /><a name="l91" />});<br /><a name="l92" /><br /><a name="l93" /><br /><a name="l94" /></span><span style="color: #FF8000">/*<br /><a name="l95" />|--------------------------------------------------------------------------<br /><a name="l96" />|&nbsp;Template&nbsp;Routes<br /><a name="l97" />|--------------------------------------------------------------------------*/<br /><a name="l98" /></span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">middleware</span><span style="color: #007700">([</span><span style="color: #DD0000">'auth.user'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">group</span><span style="color: #007700">(function&nbsp;()&nbsp;{<br /><a name="l99" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l100" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Get&nbsp;all&nbsp;templates&nbsp;*/<br /><a name="l101" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'templates'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TemplateController@getAll'</span><span style="color: #007700">);<br /><a name="l102" />});<br /><a name="l103" /><br /><a name="l104" /><br /><a name="l105" /></span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">middleware</span><span style="color: #007700">([</span><span style="color: #DD0000">'auth.author'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">group</span><span style="color: #007700">(function&nbsp;()&nbsp;{<br /><a name="l106" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l107" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Get&nbsp;specific&nbsp;template&nbsp;by&nbsp;id&nbsp;*/<br /><a name="l108" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'templates/{template}'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TemplateController@get'</span><span style="color: #007700">);<br /><a name="l109" /><br /><a name="l110" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l111" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Create&nbsp;a&nbsp;new&nbsp;template&nbsp;*/<br /><a name="l112" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">post</span><span style="color: #007700">(</span><span style="color: #DD0000">'templates'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TemplateController@create'</span><span style="color: #007700">);<br /><a name="l113" /><br /><a name="l114" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l115" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Update&nbsp;a&nbsp;specific&nbsp;template&nbsp;by&nbsp;id&nbsp;*/<br /><a name="l116" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">put</span><span style="color: #007700">(</span><span style="color: #DD0000">'templates/{template}'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TemplateController@update'</span><span style="color: #007700">);<br /><a name="l117" /><br /><a name="l118" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br /><a name="l119" />&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Delete&nbsp;a&nbsp;specific&nbsp;template&nbsp;by&nbsp;id&nbsp;*/<br /><a name="l120" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Route</span><span style="color: #007700">::</span><span style="color: #0000BB">delete</span><span style="color: #007700">(</span><span style="color: #DD0000">'templates/{template}'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TemplateController@delete'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'template'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'[0-9]+'</span><span style="color: #007700">);<br /><a name="l121" />});</span>
</span>